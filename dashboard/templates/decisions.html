{% extends "base.html" %}

{% block title %}Decisions - CSTP Dashboard{% endblock %}

{% block header %}
<div class="page-header">
    <div class="page-header-row">
        <div>
            <h1 class="page-title">Decisions</h1>
            <p class="page-subtitle">{{ total }} total decisions</p>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<!-- Filters -->
<form method="get" class="mb-6">
    <div class="form-row">
        <div class="form-group" style="margin-bottom:0">
            <select name="category" class="form-select" aria-label="Category filter">
                <option value="">All Categories</option>
                <option value="architecture" {% if category == 'architecture' %}selected{% endif %}>Architecture</option>
                <option value="process" {% if category == 'process' %}selected{% endif %}>Process</option>
                <option value="integration" {% if category == 'integration' %}selected{% endif %}>Integration</option>
                <option value="tooling" {% if category == 'tooling' %}selected{% endif %}>Tooling</option>
                <option value="security" {% if category == 'security' %}selected{% endif %}>Security</option>
            </select>
        </div>
        <div class="form-group" style="margin-bottom:0">
            <select name="status" class="form-select" aria-label="Status filter">
                <option value="">All Status</option>
                <option value="pending" {% if status == 'pending' %}selected{% endif %}>‚è≥ Pending</option>
                <option value="reviewed" {% if status == 'reviewed' %}selected{% endif %}>‚úÖ Reviewed</option>
            </select>
        </div>
        <div style="flex:0">
            <button type="submit" class="btn btn--primary">Filter</button>
        </div>
    </div>
</form>

<!-- Decision Table -->
<div class="table-wrapper">
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Decision</th>
                <th>Category</th>
                <th>Stakes</th>
                <th>Confidence</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for decision in decisions %}
            <tr>
                <td>
                    <a href="{{ url_for('decision_detail', decision_id=decision.id[:8]) }}">
                        <code>{{ decision.id[:8] }}</code>
                    </a>
                </td>
                <td>
                    <a href="{{ url_for('decision_detail', decision_id=decision.id[:8]) }}" style="color: var(--c-text-secondary)">
                        {{ decision.summary[:70] }}{% if decision.summary|length > 70 %}...{% endif %}
                    </a>
                </td>
                <td><span class="badge badge--category">{{ decision.category }}</span></td>
                <td><span class="badge badge--stakes-{{ decision.stakes }}">{{ decision.stakes }}</span></td>
                <td>
                    <div class="confidence-bar">
                        <div class="confidence-bar-track">
                            <div class="confidence-bar-fill {% if decision.confidence >= 0.9 %}confidence-bar-fill--high{% elif decision.confidence >= 0.7 %}confidence-bar-fill--mid{% else %}confidence-bar-fill--low{% endif %}"
                                 style="width: {{ decision.confidence_pct }}%"></div>
                        </div>
                        <span class="confidence-bar-label">{{ decision.confidence_pct }}%</span>
                    </div>
                </td>
                <td>{{ decision.outcome_icon }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6">
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <p class="empty-state-text">No decisions found.</p>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination -->
{% if total_pages > 1 %}
<div class="pagination">
    {% if page > 1 %}
    <a href="{{ url_for('decisions', page=page-1, category=category, status=status) }}" class="btn btn--ghost btn--sm">‚Üê Previous</a>
    {% endif %}
    <span class="pagination-info">Page {{ page }} of {{ total_pages }}</span>
    {% if page < total_pages %}
    <a href="{{ url_for('decisions', page=page+1, category=category, status=status) }}" class="btn btn--ghost btn--sm">Next ‚Üí</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}
