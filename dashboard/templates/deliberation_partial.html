<span id="session-count" hx-swap-oob="innerHTML">{{ session_count }} active</span>

{% if sessions %}
<div class="session-list" x-data="{ expanded: {} }">
    {% for session in sessions %}
    <div class="session-card">
        <div class="session-card-header" @click="expanded[{{ loop.index0 }}] = !expanded[{{ loop.index0 }}]">
            <div class="session-card-meta">
                <span class="session-pulse session-pulse--{{ session.freshness }}"></span>
                {% if session.parsed.agent_id %}
                <span class="badge badge--info">{{ session.parsed.agent_id }}</span>
                {% endif %}
                {% if session.parsed.decision_id %}
                <code class="session-decision-id">{{ session.parsed.decision_id[:8] }}</code>
                {% endif %}
                {% if session.parsed.transport %}
                <span class="badge badge--neutral">{{ session.parsed.transport }}</span>
                {% endif %}
                {% if not session.parsed.agent_id and not session.parsed.decision_id and not session.parsed.transport %}
                <code>{{ session.key }}</code>
                {% endif %}
            </div>
            <div class="flex gap-3 items-center">
                <span class="session-input-count">{{ session.input_count }} input{{ 's' if session.input_count != 1 }}</span>
                <span class="session-expand-icon" :class="{ 'session-expand-icon--open': expanded[{{ loop.index0 }}] }">&#9654;</span>
            </div>
        </div>

        <div class="session-card-body" x-show="expanded[{{ loop.index0 }}]" x-cloak>
            {% for inp in session.inputs %}
            <div class="session-input">
                <span class="badge badge--type-{{ inp.type }}">{{ inp.type }}</span>
                <span class="session-input-text">{{ inp.text }}</span>
                <span class="session-input-age {{ inp.age_class }}">{{ inp.age_display }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <div class="empty-state-icon">&#128172;</div>
    <p class="empty-state-text">No active deliberation sessions.{% if filter_key %} Try clearing the filter.{% endif %}</p>
</div>
{% endif %}
